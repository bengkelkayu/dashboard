- name: Deploy to VPS (Full Setup)
  if: ${{ github.event.inputs.deploy_type == 'full' || github.event.inputs.deploy_type == 'setup-only' }}
  env:
    VPS_PASSWORD: ${{ secrets.VPS_PASSWORD }}
  run: |
    sshpass -p "$VPS_PASSWORD" ssh -o StrictHostKeyChecking=no root@${{ secrets.VPS_HOST }} << 'ENDSSH'
      set -e
      
      echo "================================================"
      echo "ðŸš€ Starting VPS Setup and Deployment"
      echo "================================================"
      
      # Update system
      echo "ðŸ“¦ Updating system packages..."
      export DEBIAN_FRONTEND=noninteractive
      apt-get update
      apt-get upgrade -y
      
      # Force install Node.js v20
      echo "ðŸ“¦ Installing Node.js v20..."
      curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
      apt-get install -y nodejs
      echo "âœ“ Node.js installed: $(node --version)"
      
      # Install PostgreSQL
      echo "ðŸ“¦ Installing PostgreSQL..."
      if ! command -v psql &> /dev/null; then
        apt-get install -y postgresql postgresql-contrib
        systemctl start postgresql
        systemctl enable postgresql
        echo "âœ“ PostgreSQL installed"
      else
        echo "âœ“ PostgreSQL already installed"
      fi
      
      # Install Redis
      echo "ðŸ“¦ Installing Redis..."
      if ! command -v redis-cli &> /dev/null; then
        apt-get install -y redis-server
        systemctl start redis-server
        systemctl enable redis-server
        echo "âœ“ Redis installed"
      else
        echo "âœ“ Redis already installed"
      fi
      
      # Install Nginx
      echo "ðŸ“¦ Installing Nginx..."
      if ! command -v nginx &> /dev/null; then
        apt-get install -y nginx
        systemctl start nginx
        systemctl enable nginx
        echo "âœ“ Nginx installed"
      else
        echo "âœ“ Nginx already installed"
      fi
      
      # Install PM2
      echo "ðŸ“¦ Installing PM2..."
      if ! command -v pm2 &> /dev/null; then
        npm install -g pm2
        echo "âœ“ PM2 installed"
      else
        echo "âœ“ PM2 already installed"
      fi
      
      # Install Git
      if ! command -v git &> /dev/null; then
        apt-get install -y git
        echo "âœ“ Git installed"
      fi
      
      echo "âœ¨ System setup completed!"
    ENDSSH
